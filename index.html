<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Workout</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: #eee;
      padding: 16px;
      padding-bottom: 100px;
    }

    h1 {
      text-align: center;
      font-size: 20px;
      margin-bottom: 16px;
      color: #e94560;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      border-bottom: 2px solid #333;
      padding-bottom: 8px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px 16px;
      border: none;
      background: transparent;
      color: #aaa;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      transition: all 0.2s;
    }

    .tab-btn.active {
      background: #e94560;
      color: #fff;
    }

    .days-nav {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      margin-bottom: 20px;
      padding-bottom: 4px;
    }

    .day-btn {
      flex-shrink: 0;
      padding: 8px 12px;
      border: 1px solid #333;
      border-radius: 8px;
      background: #16213e;
      color: #aaa;
      font-size: 13px;
      cursor: pointer;
      text-align: center;
      min-width: 44px;
    }

    .day-btn.active {
      background: #e94560;
      color: #fff;
      border-color: #e94560;
      font-weight: bold;
    }

    .day-btn.today {
      border-color: #e94560;
    }

    .workout-card {
      background: #16213e;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .workout-type {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #e94560;
      margin-bottom: 4px;
    }

    .workout-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 12px;
    }

    .workout-duration {
      font-size: 13px;
      color: #aaa;
      margin-bottom: 16px;
    }

    .rest-day {
      text-align: center;
      padding: 40px 16px;
    }

    .rest-day p {
      color: #aaa;
      font-size: 14px;
      margin-top: 12px;
    }

    .exercise {
      background: #0f3460;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      cursor: pointer;
    }

    .exercise-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .exercise-name {
      font-weight: 600;
      font-size: 15px;
    }

    .exercise-sets {
      font-size: 13px;
      color: #e94560;
      font-weight: 600;
    }

    .exercise-detail {
      font-size: 12px;
      color: #aaa;
      margin-top: 4px;
    }

    .exercise-desc {
      font-size: 12px;
      color: #888;
      margin-top: 6px;
      line-height: 1.4;
      display: none;
    }

    .exercise.expanded .exercise-desc {
      display: block;
    }

    .exercise-toggle {
      font-size: 11px;
      color: #e94560;
      margin-top: 6px;
      display: inline-block;
    }

    .section-title {
      font-size: 13px;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      margin-top: 16px;
    }

    .info-box {
      background: #0f3460;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .info-label {
      color: #aaa;
      font-size: 12px;
    }

    .info-value {
      font-weight: 600;
      color: #e94560;
    }

    .cardio-option {
      background: #0f3460;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
    }

    .cardio-option-title {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 6px;
    }

    .cardio-option-detail {
      font-size: 13px;
      color: #aaa;
      line-height: 1.5;
    }

    .metrics-card {
      background: #16213e;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }

    .metric-item {
      background: #0f3460;
      padding: 10px;
      border-radius: 8px;
    }

    .metric-label {
      font-size: 11px;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 18px;
      font-weight: bold;
      color: #e94560;
    }

    .nutrition-card {
      background: #16213e;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .nutrition-summary {
      background: #0f3460;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .calories-main {
      font-size: 24px;
      font-weight: bold;
      color: #e94560;
    }

    .calories-label {
      font-size: 12px;
      color: #aaa;
      margin-top: 2px;
    }

    .calories-target {
      text-align: right;
    }

    .calories-target-value {
      font-size: 18px;
      font-weight: 600;
      color: #4ecca3;
    }

    .meal-item {
      background: #0f3460;
      padding: 10px 12px;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .meal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .meal-name {
      font-size: 13px;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .meal-calories {
      font-size: 15px;
      font-weight: bold;
      color: #e94560;
    }

    .meal-description {
      font-size: 13px;
      color: #ccc;
      line-height: 1.4;
    }

    .no-data {
      text-align: center;
      padding: 40px 16px;
      color: #aaa;
    }

    .chart-card {
      background: #16213e;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .chart-card canvas {
      width: 100%;
      height: 180px;
      border-radius: 8px;
      margin-top: 12px;
    }

    .sleep-phases {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin-top: 12px;
    }

    #app { }
  </style>
</head>
<body>

  <h1>My Workout</h1>

  <div class="tabs">
    <button class="tab-btn" id="tabWorkout">План тренувань</button>
    <button class="tab-btn" id="tabTracking">Мої дані</button>
    <button class="tab-btn" id="tabStats">Статистика</button>
  </div>

  <div class="days-nav" id="daysNav"></div>
  <div id="app"></div>

  <script>
    var workoutData = [];
    var DAYS = ['Нд', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'];
    var DAYS_FULL = ['Неділя', 'Понеділок', 'Вівторок', 'Середа', 'Четвер', "П'ятниця", 'Субота'];

    function createEl(tag, className, text) {
      var el = document.createElement(tag);
      if (className) el.className = className;
      if (text) el.textContent = text;
      return el;
    }

    function renderDaysNav(selectedDay) {
      var nav = document.getElementById('daysNav');
      while (nav.firstChild) nav.removeChild(nav.firstChild);
      var order = [1, 2, 3, 4, 5, 6, 0];
      var today = new Date().getDay();

      order.forEach(function(dayIndex) {
        var btn = createEl('div', 'day-btn', DAYS[dayIndex]);
        if (dayIndex === selectedDay) btn.classList.add('active');
        if (dayIndex === today && dayIndex !== selectedDay) btn.classList.add('today');
        btn.addEventListener('click', function() { showDay(dayIndex); });
        nav.appendChild(btn);
      });
    }

    function buildExerciseEl(ex, index) {
      var div = createEl('div', 'exercise');
      div.id = 'ex-' + index;

      var header = createEl('div', 'exercise-header');
      header.appendChild(createEl('span', 'exercise-name', ex.name));
      header.appendChild(createEl('span', 'exercise-sets', ex.sets));
      div.appendChild(header);

      if (ex.detail) {
        div.appendChild(createEl('div', 'exercise-detail', ex.detail));
      }

      if (ex.desc) {
        var descEl = createEl('div', 'exercise-desc', ex.desc);
        div.appendChild(descEl);

        var toggleEl = createEl('div', 'exercise-toggle', 'Як робити ▼');
        div.appendChild(toggleEl);

        div.addEventListener('click', function() {
          div.classList.toggle('expanded');
          toggleEl.textContent = div.classList.contains('expanded') ? 'Сховати ▲' : 'Як робити ▼';
        });
      }

      return div;
    }

    function buildCardioContent() {
      var frag = document.createDocumentFragment();

      var pulseBox = createEl('div', 'info-box');
      pulseBox.appendChild(createEl('span', 'info-label', 'Пульс: '));
      pulseBox.appendChild(createEl('span', 'info-value', '120-140'));
      frag.appendChild(pulseBox);

      frag.appendChild(createEl('div', 'section-title', 'Обери варіант'));

      // Velotrenazher
      var opt1 = createEl('div', 'cardio-option');
      opt1.appendChild(createEl('div', 'cardio-option-title', 'Велотренажер'));
      opt1.appendChild(createEl('div', 'cardio-option-detail', '30-40 хв, тримай пульс 120-140. Якщо пульс нижче — додай навантаження.'));
      frag.appendChild(opt1);

      // Shadow boxing
      var opt2 = createEl('div', 'cardio-option');
      opt2.appendChild(createEl('div', 'cardio-option-title', 'Shadow Boxing'));
      var detail2 = createEl('div', 'cardio-option-detail');
      var lines2 = [
        'Розминка 3 хв',
        'Удари лівою: 100 разів',
        'Удари правою: 100 разів',
        'Повторити 2-3 серії',
        'Уклони: 50-100 разів',
        'Маятник: 2-3 хв',
        'Комбінації: 10 хв'
      ];
      lines2.forEach(function(line, i) {
        detail2.appendChild(document.createTextNode(line));
        if (i < lines2.length - 1) detail2.appendChild(document.createElement('br'));
      });
      opt2.appendChild(detail2);
      frag.appendChild(opt2);

      // Skakalka
      var opt3 = createEl('div', 'cardio-option');
      opt3.appendChild(createEl('div', 'cardio-option-title', 'Скакалка'));
      var detail3 = createEl('div', 'cardio-option-detail');
      detail3.appendChild(document.createTextNode('1 хв стрибки → 30 сек відпочинок'));
      detail3.appendChild(document.createElement('br'));
      detail3.appendChild(document.createTextNode('Повторити 15-20 раундів'));
      opt3.appendChild(detail3);
      frag.appendChild(opt3);

      return frag;
    }

    var exercises = {
      wednesday: [
        { name: 'Розминка', sets: '3-5 хв', desc: 'Розігрій суглоби: обертання рук, плечей, нахили. Легке кардіо 2-3 хв.' },
        { name: 'Віджимання', sets: '3 × 10-15', desc: 'Руки на ширині плечей, тіло рівне як дошка. Опускаєшся поки груди майже торкнуться підлоги, піднімаєшся. Якщо важко — можна з колін.' },
        { name: 'Жим гантелей вгору', sets: '3 × 10-12', detail: '6-8 кг', desc: 'Сидячи або стоячи. Гантелі на рівні плечей, долоні вперед. Вижимаєш вгору над головою, руки повністю випрямляються. Повільно опускаєш назад.' },
        { name: 'Тяга гантелей в нахилі', sets: '3 × 10-12', detail: '8-10 кг, кожна рука', desc: 'Нахились вперед на 45°, спина рівна. Гантель в одній руці, тягни до пояса, лікоть вздовж тіла. Друга рука на коліні для опори. Зміни руку.' },
        { name: 'Біцепс з гантелями', sets: '3 × 12', detail: '4-6 кг', desc: 'Стоїш рівно, руки з гантелями вздовж тіла. Згинаєш руки в ліктях, піднімаючи гантелі до плечей. Лікті нерухомі, працює тільки передпліччя.' },
        { name: 'Тріцепс за головою', sets: '3 × 12', detail: '4-6 кг', desc: 'Одна гантель двома руками за головою. Лікті вгору біля голови. Випрямляєш руки вгору, потім повільно опускаєш за голову. Лікті залишаються на місці.' }
      ],
      friday: [
        { name: 'Розминка', sets: '3-5 хв', desc: 'Розігрій суглоби: обертання колін, тазу, нахили. Легке кардіо 2-3 хв.' },
        { name: 'Напівприсяди з гантелями', sets: '3 × 15', detail: '8-12 кг', desc: 'Гантелі в руках вздовж тіла або на плечах. Ноги на ширині плечей. Присідаєш до 90° в колінах (не глибше — бережи коліна). Спина рівна, коліна не виходять за носки.' },
        { name: 'Випади', sets: '3 × 10 (кожна нога)', detail: '6-8 кг', desc: 'Гантелі в руках. Крок вперед однією ногою, опускаєшся поки обидва коліна не зігнуться на 90°. Заднє коліно майже торкається підлоги. Повертаєшся, зміна ноги.' },
        { name: 'Румунська тяга', sets: '3 × 12', detail: '8-10 кг', desc: 'Стоїш рівно, гантелі в руках перед собою. Нахиляєшся вперед, відводячи таз назад. Ноги майже рівні (легкий згин в колінах). Відчуваєш розтяжку ззаду стегна. Повертаєшся.' },
        { name: 'Підйом на носки', sets: '3 × 20', detail: '10-12 кг', desc: 'Стоїш рівно, гантелі в руках. Піднімаєшся на носки максимально високо, затримка 1 сек, повільно опускаєшся.' },
        { name: 'Планка', sets: '3 × 30-60 сек', desc: 'Упор лежачи на передпліччях. Тіло рівне від голови до п\'ят — не провисай і не піднімай таз. Тримай 30-60 сек.' },
        { name: 'Скручування', sets: '3 × 15-20', desc: 'Лежиш на спині, ноги зігнуті. Руки за головою або на грудях. Піднімаєш плечі від підлоги, скручуючи корпус. Поперек залишається на підлозі.' }
      ],
      sunday: [
        { name: 'Розминка', sets: '3-5 хв', desc: 'Розігрій все тіло: обертання суглобів, легке кардіо 2-3 хв.' },
        { name: 'Віджимання', sets: '2 × 12-15', desc: 'Руки на ширині плечей, тіло рівне як дошка. Опускаєшся поки груди майже торкнуться підлоги, піднімаєшся.' },
        { name: 'Напівприсяди', sets: '2 × 15', detail: '8-12 кг', desc: 'Гантелі в руках. Присідаєш до 90° в колінах. Спина рівна, коліна не виходять за носки.' },
        { name: 'Тяга гантелей', sets: '2 × 10-12', detail: '8-10 кг', desc: 'Нахились вперед на 45°, спина рівна. Гантель в одній руці, тягни до пояса. Зміни руку.' },
        { name: 'Випади', sets: '2 × 10 (кожна нога)', detail: '6-8 кг', desc: 'Крок вперед, опускаєшся поки обидва коліна 90°. Заднє коліно майже торкається підлоги.' },
        { name: 'Жим вгору', sets: '2 × 10-12', detail: '6-8 кг', desc: 'Гантелі на рівні плечей. Вижимаєш вгору над головою. Повільно опускаєш.' },
        { name: 'Планка', sets: '2 × 45 сек', desc: 'Упор на передпліччях. Тіло рівне від голови до п\'ят. Тримай.' }
      ]
    };

    function showDay(dayIndex) {
      var app = document.getElementById('app');
      while (app.firstChild) app.removeChild(app.firstChild);
      renderDaysNav(dayIndex);

      var card = createEl('div', 'workout-card');

      // Monday - rest
      if (dayIndex === 1) {
        card.classList.add('rest-day');
        card.appendChild(createEl('div', 'workout-title', 'День відпочинку'));
        card.appendChild(createEl('p', null, 'Відновлення. Можна легку прогулянку.'));
        app.appendChild(card);
        return;
      }

      // Cardio days: Tue(2), Thu(4), Sat(6)
      if (dayIndex === 2 || dayIndex === 4 || dayIndex === 6) {
        card.appendChild(createEl('div', 'workout-type', 'Кардіо'));
        card.appendChild(createEl('div', 'workout-title', DAYS_FULL[dayIndex] + ' — Кардіо'));
        card.appendChild(createEl('div', 'workout-duration', '30-40 хв'));
        card.appendChild(buildCardioContent());
        app.appendChild(card);
        return;
      }

      // Strength days
      var titles = { 3: 'Силові: верх тіла', 5: 'Силові: низ + корпус', 0: 'Силові: все тіло' };
      var exKeys = { 3: 'wednesday', 5: 'friday', 0: 'sunday' };

      card.appendChild(createEl('div', 'workout-type', 'Силові'));
      card.appendChild(createEl('div', 'workout-title', DAYS_FULL[dayIndex] + ' — ' + titles[dayIndex]));
      card.appendChild(createEl('div', 'workout-duration', '30-40 хв'));

      var restBox = createEl('div', 'info-box');
      restBox.appendChild(createEl('span', 'info-label', 'Відпочинок: '));
      restBox.appendChild(createEl('span', 'info-value', '60-90 сек між підходами'));
      card.appendChild(restBox);

      card.appendChild(createEl('div', 'section-title', 'Вправи'));

      var exList = exercises[exKeys[dayIndex]];
      exList.forEach(function(ex, i) {
        card.appendChild(buildExerciseEl(ex, i));
      });

      app.appendChild(card);
    }

    // Tabs and tracking mode
    var currentMode = localStorage.getItem('activeTab') || 'workout';
    var selectedTrackingDate = null;

    function switchTab(mode) {
      currentMode = mode;
      localStorage.setItem('activeTab', mode);

      var tabWorkout = document.getElementById('tabWorkout');
      var tabTracking = document.getElementById('tabTracking');
      var tabStats = document.getElementById('tabStats');
      var daysNav = document.getElementById('daysNav');

      tabWorkout.classList.remove('active');
      tabTracking.classList.remove('active');
      tabStats.classList.remove('active');

      if (mode === 'workout') {
        tabWorkout.classList.add('active');
        daysNav.style.display = '';
        showDay(new Date().getDay());
      } else if (mode === 'tracking') {
        tabTracking.classList.add('active');
        daysNav.style.display = '';
        showTrackingData();
      } else {
        tabStats.classList.add('active');
        daysNav.style.display = 'none';
        showStats();
      }
    }

    function showTrackingData() {
      var nav = document.getElementById('daysNav');
      while (nav.firstChild) nav.removeChild(nav.firstChild);

      var app = document.getElementById('app');
      while (app.firstChild) app.removeChild(app.firstChild);

      if (!workoutData || workoutData.length === 0) {
        app.appendChild(createEl('div', 'no-data', 'Немає даних для відображення'));
        return;
      }

      // Create date buttons
      workoutData.forEach(function(entry) {
        var btn = createEl('div', 'day-btn', entry.date.substring(5));
        if (selectedTrackingDate === entry.date) btn.classList.add('active');
        btn.addEventListener('click', function() {
          selectedTrackingDate = entry.date;
          showDayTracking(entry);
        });
        nav.appendChild(btn);
      });

      // Show today if exists, otherwise last day
      if (!selectedTrackingDate && workoutData.length > 0) {
        var today = new Date().toISOString().substring(0, 10);
        var todayEntry = workoutData.find(function(d) { return d.date === today; });
        selectedTrackingDate = todayEntry ? today : workoutData[workoutData.length - 1].date;
      }

      var dayData = workoutData.find(function(d) { return d.date === selectedTrackingDate; });
      if (dayData) showDayTracking(dayData);
    }

    function showDayTracking(dayData) {
      var app = document.getElementById('app');
      while (app.firstChild) app.removeChild(app.firstChild);

      // Update nav
      var nav = document.getElementById('daysNav');
      var btns = nav.querySelectorAll('.day-btn');
      btns.forEach(function(btn) {
        btn.classList.remove('active');
        if (btn.textContent === dayData.date.substring(5)) {
          btn.classList.add('active');
        }
      });

      // Metrics card
      var metricsCard = createEl('div', 'metrics-card');
      metricsCard.appendChild(createEl('div', 'workout-type', dayData.dayOfWeek + ' — ' + dayData.date));

      var grid = createEl('div', 'metrics-grid');

      var weightItem = createEl('div', 'metric-item');
      weightItem.appendChild(createEl('div', 'metric-label', 'Вага'));
      weightItem.appendChild(createEl('div', 'metric-value', dayData.morningWeight + ' кг'));
      grid.appendChild(weightItem);

      var fatItem = createEl('div', 'metric-item');
      fatItem.appendChild(createEl('div', 'metric-label', 'Body Fat'));
      fatItem.appendChild(createEl('div', 'metric-value', dayData.bodyFatPercent + '%'));
      grid.appendChild(fatItem);

      var visceralItem = createEl('div', 'metric-item');
      visceralItem.appendChild(createEl('div', 'metric-label', 'Віцеральний жир'));
      visceralItem.appendChild(createEl('div', 'metric-value', dayData.visceralFat));
      grid.appendChild(visceralItem);

      var muscleItem = createEl('div', 'metric-item');
      muscleItem.appendChild(createEl('div', 'metric-label', "М'язи"));
      muscleItem.appendChild(createEl('div', 'metric-value', dayData.musclePercent + '%'));
      grid.appendChild(muscleItem);

      metricsCard.appendChild(grid);
      app.appendChild(metricsCard);

      // Sleep card
      if (dayData.sleep) {
        var sleepCard = createEl('div', 'metrics-card');
        sleepCard.appendChild(createEl('div', 'workout-type', 'Сон'));

        var sleepGrid = createEl('div', 'metrics-grid');

        var durItem = createEl('div', 'metric-item');
        durItem.appendChild(createEl('div', 'metric-label', 'Тривалість'));
        durItem.appendChild(createEl('div', 'metric-value', dayData.sleep.duration));
        sleepGrid.appendChild(durItem);

        if (dayData.sleep.score) {
          var scoreItem = createEl('div', 'metric-item');
          scoreItem.appendChild(createEl('div', 'metric-label', 'Оцінка'));
          var scoreText = dayData.sleep.score.duration + ' | ' + dayData.sleep.score.bedtime + ' | ' + dayData.sleep.score.interruption;
          scoreItem.appendChild(createEl('div', 'metric-value', scoreText));
          scoreItem.querySelector('.metric-value').style.fontSize = '13px';
          sleepGrid.appendChild(scoreItem);
        }

        if (dayData.sleep.heartRate) {
          var hrItem = createEl('div', 'metric-item');
          hrItem.appendChild(createEl('div', 'metric-label', 'Пульс'));
          hrItem.appendChild(createEl('div', 'metric-value', dayData.sleep.heartRate.min + '-' + dayData.sleep.heartRate.max + ' bpm'));
          sleepGrid.appendChild(hrItem);
        }

        if (dayData.sleep.respiratoryRate) {
          var rrItem = createEl('div', 'metric-item');
          rrItem.appendChild(createEl('div', 'metric-label', 'Дихання'));
          rrItem.appendChild(createEl('div', 'metric-value', dayData.sleep.respiratoryRate.min + '-' + dayData.sleep.respiratoryRate.max));
          sleepGrid.appendChild(rrItem);
        }

        sleepCard.appendChild(sleepGrid);

        if (dayData.sleep.phases) {
          var phasesDiv = createEl('div', 'sleep-phases');
          var phases = [
            { label: 'REM', value: dayData.sleep.phases.rem },
            { label: 'Core', value: dayData.sleep.phases.core },
            { label: 'Deep', value: dayData.sleep.phases.deep }
          ];
          phases.forEach(function(p) {
            var phItem = createEl('div', 'metric-item');
            phItem.appendChild(createEl('div', 'metric-label', p.label));
            phItem.appendChild(createEl('div', 'metric-value', p.value));
            phasesDiv.appendChild(phItem);
          });
          sleepCard.appendChild(phasesDiv);
        }

        app.appendChild(sleepCard);
      }

      // Nutrition card
      if (dayData.nutrition) {
        var nutritionCard = createEl('div', 'nutrition-card');
        nutritionCard.appendChild(createEl('div', 'workout-type', 'Харчування'));

        var summary = createEl('div', 'nutrition-summary');
        var left = createEl('div');
        left.appendChild(createEl('div', 'calories-main', dayData.nutrition.totalCalories + ' ккал'));
        left.appendChild(createEl('div', 'calories-label', "з'їдено"));
        summary.appendChild(left);

        var right = createEl('div', 'calories-target');
        right.appendChild(createEl('div', 'calories-target-value', dayData.nutrition.remaining + ' ккал'));
        right.appendChild(createEl('div', 'calories-label', 'залишилось'));
        summary.appendChild(right);

        nutritionCard.appendChild(summary);

        // Meals
        var meals = [
          { name: 'Сніданок', data: dayData.nutrition.breakfast },
          { name: 'Обід', data: dayData.nutrition.lunch },
          { name: 'Вечеря', data: dayData.nutrition.dinner },
          { name: 'Перекуси', data: dayData.nutrition.snacks }
        ];

        meals.forEach(function(meal) {
          if (meal.data && meal.data.calories > 0) {
            var mealItem = createEl('div', 'meal-item');

            var header = createEl('div', 'meal-header');
            header.appendChild(createEl('div', 'meal-name', meal.name));
            header.appendChild(createEl('div', 'meal-calories', meal.data.calories + ' ккал'));
            mealItem.appendChild(header);

            if (meal.data.description) {
              mealItem.appendChild(createEl('div', 'meal-description', meal.data.description));
            }

            nutritionCard.appendChild(mealItem);
          }
        });

        app.appendChild(nutritionCard);
      }

      // Workout card
      if (dayData.type !== 'rest') {
        var workoutCard = createEl('div', 'workout-card');
        workoutCard.appendChild(createEl('div', 'workout-type', dayData.type === 'cardio' ? 'Кардіо' : 'Силові'));
        workoutCard.appendChild(createEl('div', 'workout-title', dayData.title));
        workoutCard.appendChild(createEl('div', 'workout-duration', dayData.duration + ' хв'));

        if (dayData.feeling) {
          var feelingBox = createEl('div', 'info-box');
          feelingBox.appendChild(createEl('span', 'info-label', 'Самопочуття: '));
          feelingBox.appendChild(createEl('span', 'info-value', dayData.feeling + '/5'));
          workoutCard.appendChild(feelingBox);
        }

        if (dayData.appleWatch) {
          workoutCard.appendChild(createEl('div', 'section-title', 'Apple Watch'));

          var awBox = createEl('div', 'info-box');
          var awLabel1 = createEl('span', 'info-label', 'Активні калорії: ');
          var awValue1 = createEl('span', 'info-value', dayData.appleWatch.activeCalories + ' ккал');
          awBox.appendChild(awLabel1);
          awBox.appendChild(awValue1);
          awBox.appendChild(document.createElement('br'));

          var awLabel2 = createEl('span', 'info-label', 'Середній пульс: ');
          var awValue2 = createEl('span', 'info-value', dayData.appleWatch.avgHeartRate + ' bpm');
          awBox.appendChild(awLabel2);
          awBox.appendChild(awValue2);
          awBox.appendChild(document.createElement('br'));

          var awLabel3 = createEl('span', 'info-label', 'Макс пульс: ');
          var awValue3 = createEl('span', 'info-value', dayData.appleWatch.maxHeartRate + ' bpm');
          awBox.appendChild(awLabel3);
          awBox.appendChild(awValue3);

          workoutCard.appendChild(awBox);
        }

        if (dayData.notes) {
          workoutCard.appendChild(createEl('div', 'section-title', 'Нотатки'));
          var notesBox = createEl('div', 'info-box');
          notesBox.textContent = dayData.notes;
          workoutCard.appendChild(notesBox);
        }

        app.appendChild(workoutCard);
      }
    }

    // Statistics
    function drawLineChart(canvas, labels, values, color) {
      var ctx = canvas.getContext('2d');
      var dpr = window.devicePixelRatio || 1;
      var rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.scale(dpr, dpr);

      var w = rect.width;
      var h = rect.height;
      var padL = 48;
      var padR = 16;
      var padT = 16;
      var padB = 32;
      var chartW = w - padL - padR;
      var chartH = h - padT - padB;

      if (values.length === 0) return;

      var min = Math.min.apply(null, values);
      var max = Math.max.apply(null, values);
      var range = max - min || 1;
      min = min - range * 0.1;
      max = max + range * 0.1;
      range = max - min;

      // Grid lines
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 0.5;
      ctx.font = '11px -apple-system, sans-serif';
      ctx.fillStyle = '#888';
      ctx.textAlign = 'right';

      for (var g = 0; g <= 4; g++) {
        var gy = padT + chartH - (g / 4) * chartH;
        ctx.beginPath();
        ctx.moveTo(padL, gy);
        ctx.lineTo(padL + chartW, gy);
        ctx.stroke();
        var gVal = min + (g / 4) * range;
        ctx.fillText(gVal.toFixed(1), padL - 6, gy + 4);
      }

      // X labels
      ctx.textAlign = 'center';
      ctx.fillStyle = '#888';
      labels.forEach(function(label, i) {
        var x = padL + (i / (labels.length - 1 || 1)) * chartW;
        ctx.fillText(label, x, h - 6);
      });

      // Line
      ctx.beginPath();
      ctx.strokeStyle = color;
      ctx.lineWidth = 2.5;
      ctx.lineJoin = 'round';
      values.forEach(function(v, i) {
        var x = padL + (i / (values.length - 1 || 1)) * chartW;
        var y = padT + chartH - ((v - min) / range) * chartH;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();

      // Dots
      ctx.fillStyle = color;
      values.forEach(function(v, i) {
        var x = padL + (i / (values.length - 1 || 1)) * chartW;
        var y = padT + chartH - ((v - min) / range) * chartH;
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function showStats() {
      var nav = document.getElementById('daysNav');
      while (nav.firstChild) nav.removeChild(nav.firstChild);

      var app = document.getElementById('app');
      while (app.firstChild) app.removeChild(app.firstChild);

      if (!workoutData || workoutData.length === 0) {
        app.appendChild(createEl('div', 'no-data', 'Немає даних для статистики'));
        return;
      }

      var labels = workoutData.map(function(d) { return d.date.substring(5); });

      var charts = [
        { title: 'Вага (кг)', key: 'morningWeight', color: '#e94560' },
        { title: 'Body Fat (%)', key: 'bodyFatPercent', color: '#ff6b6b' },
        { title: 'Віцеральний жир', key: 'visceralFat', color: '#ffa502' },
        { title: "М'язи (%)", key: 'musclePercent', color: '#4ecca3' }
      ];

      charts.forEach(function(chart) {
        var values = workoutData.map(function(d) { return d[chart.key]; });
        if (values.every(function(v) { return v == null; })) return;

        var card = createEl('div', 'chart-card');
        card.appendChild(createEl('div', 'workout-type', chart.title));

        // Show current value
        var lastVal = values[values.length - 1];
        if (lastVal != null) {
          card.appendChild(createEl('div', 'metric-value', String(lastVal)));
        }

        var canvas = document.createElement('canvas');
        card.appendChild(canvas);
        app.appendChild(card);

        drawLineChart(canvas, labels, values, chart.color);
      });
    }

    // Tab handlers
    document.getElementById('tabWorkout').addEventListener('click', function() {
      switchTab('workout');
    });

    document.getElementById('tabTracking').addEventListener('click', function() {
      switchTab('tracking');
    });

    document.getElementById('tabStats').addEventListener('click', function() {
      switchTab('stats');
    });

    // Load data from logs and restore tab
    function loadData() {
      var now = new Date();
      var file = 'logs/' + now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '.json';
      fetch(file)
        .then(function(r) { return r.json(); })
        .then(function(data) {
          workoutData = data;
          switchTab(currentMode);
        })
        .catch(function() {
          workoutData = [];
          switchTab(currentMode);
        });
    }

    loadData();
  </script>
</body>
</html>
